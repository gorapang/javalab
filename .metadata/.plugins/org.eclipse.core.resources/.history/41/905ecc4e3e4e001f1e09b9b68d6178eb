package running;

import javax.persistence.EntityManager;
import javax.persistence.EntityTransaction;

import org.junit.Test;

import model.domain.entity.Customer;
import util.DBUtil;

public class RunningTest {
	
	//step03 : 존재하는 customer table 검색 -> 수정 -> 검색 -> 삭제
	@Test
	public void step03() {
		EntityManager em = DBUtil.getEntityManager();
		EntityTransaction tx = em.getTransaction();
		
		Customer c = em.find(Customer.class, 9); //select
		System.out.println(c);

		c = em.find(Customer.class, 9); //non-select
		System.out.println(c);
		
		tx.begin();
		
		c.setAge(20); //update 준비(DB에 영구 적용 직전, 영속성 영역에 이미 반영)
		em.remove(c); //delete 준비(DB에 영구 적용 직전, 영속성 영역에 이미 반영) persistence context의 내용도 삭제 의미 + delete 문장 생성
		
		//em.clear();
		c = em.find(Customer.class, 9); // select?
		System.out.println(c); // commit()시: null, non-commit()시: null
		
		tx.commit(); //실제 db에 update와 delete 수행
		
		em.close();
	}
	
	
	
	//step02: 저장 시도는 하나 commit 안함. 검색, 단 setXxx 메소드로 값 수정 시도
	//@Test
	public void step02() {
		
		EntityManager em = DBUtil.getEntityManager();

		em.persist(new Customer("id2", "연아", 50)); 
			
		Customer c1 = em.find(Customer.class, 1); //no가 2인 데이터 검색
		System.out.println("-1- " + c1); // -1- null
		
		c1.setName("박지오");
		System.out.println("-2- " + c1);
		
		
		c1 = em.find(Customer.class, 10);
		System.out.println("-3- " + c1);
		em.close();
	}

	
	
	//step01: insert, select
	//@Test
	public void step01() {
		
		EntityManager em = DBUtil.getEntityManager();
		EntityTransaction tx = em.getTransaction();
		tx.begin();
		
		em.persist(new Customer("id1", "연아", 50)); //no가 1로 저장되어 있음
		
		//Customer c1 = em.find(Customer.class, 1);
		//System.out.println(c1);
		
		//c1.setName("유다연");
		tx.commit(); 
	
		em.close();
	}
}


